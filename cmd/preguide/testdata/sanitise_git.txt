# Test that we get the expected output when a step involves
# git commands that should be sanitised

# Intial run
preguide gen -out _output
! stdout .+
! stderr .+
cmp _output/myguide.markdown myguide/en.markdown.golden
cmp myguide/en_log.txt myguide/en_log.txt.golden

-- go.mod --
module mod.com/init

go 1.12

-- myguide/en.markdown --
---
title: A test with output that should be sanitised
---

<!--step: step1 -->

<!--step: step2 -->

<!--step: step3 -->
-- myguide/steps.cue --
package steps

import "github.com/play-with-go/preguide"

Scenarios: go115: preguide.#Scenario & {
	Description: "Go 1.15"
}

Terminals: term1: preguide.#Terminal & {
	Description: "The main terminal"
	Scenarios: go115: Image: "this_will_never_be_used"
}

Steps: step1: en: preguide.#Command & {
	Source: """
mkdir example
cd example
git init
"""
}

Steps: step2: en: preguide.#Upload & {
	Target: "/home/gopher/example/README.md"
	Source: """
This is a test.
"""
}

Steps: step3: en: preguide.#Command & {
	Source: """
git add -A
git commit -am 'Initial commit'
"""
}
-- myguide/en.markdown.golden --
---
guide: myguide
lang: en
title: A test with output that should be sanitised
---

```.term1
$ mkdir example
$ cd example
$ git init
Initialized empty Git repository in /home/gopher/example/.git/
```
{:data-command-src="bWtkaXIgZXhhbXBsZQpjZCBleGFtcGxlCmdpdCBpbml0Cg=="}

```md
This is a test.
```
{:data-upload-path="L2hvbWUvZ29waGVyL2V4YW1wbGU=" data-upload-src="UkVBRE1FLm1k:VGhpcyBpcyBhIHRlc3Qu" data-upload-term=".term1"}

```.term1
$ git add -A
$ git commit -am 'Initial commit'
[main (root-commit) abcd123] Initial commit
 1 file changed, 1 insertion(+)
 create mode 100644 README.md
```
{:data-command-src="Z2l0IGFkZCAtQQpnaXQgY29tbWl0IC1hbSAnSW5pdGlhbCBjb21taXQnCg=="}
<script>let pageGuide="myguide"; let pageLanguage="en"; let pageScenario="go115";</script>
-- myguide/en_log.txt.golden --
Terminals: [
  {
    "Name": "term1",
    "Description": "The main terminal",
    "Scenarios": {
      "go115": {
        "Image": "this_will_never_be_used"
      }
    }
  }
]
$ mkdir example
$ cd example
$ git init
Initialized empty Git repository in /home/gopher/example/.git/
$ cat <<EOD > /home/gopher/example/README.md
This is a test.
EOD
$ git add -A
$ git commit -am 'Initial commit'
[main (root-commit) abcd123] Initial commit
 1 file changed, 1 insertion(+)
 create mode 100644 README.md
