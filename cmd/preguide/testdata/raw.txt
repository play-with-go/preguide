# Test that we get the expected output when using -raw

# A run should generate stdout but no out/gen_out.cue file
preguide gen -raw -out _output
cmp stdout raw/stdout
! stderr .+
! exists raw/out/gen_out.cue

-- raw/en.markdown --
---
title: A test with raw output
---

<!--step: step1 -->
-- raw/steps.cue --
package steps

import "github.com/play-with-go/preguide"

// We embed preguide.#Guide here as a check that doing so
// means we can correctly validate, decode etc the package
// (because if you try to extract position information from
// the cue.Value that is the package in this case it will
// fail, because of the unification with preguide.#Guide)
preguide.#Guide

Env: ["A=B"]

Terminals: term1: preguide.#Guide.#Terminal & {
	Description: "The main terminal"
	Scenarios: go115: Image: "this_will_never_be_used"
}

Scenarios: go115: {
	Description: "Go 1.15"
}

Steps: step1: en: preguide.#Command & {Source: """
echo -n "Hello, world!"
"""}

Steps: step2: en: preguide.#Upload & {
	Target: "/home/gopher/special.sh"
	Source: """
echo -n "Hello, world!"
"""
}
-- raw/stdout --
package out

{
	Scenarios: [{
		Name:        "go115"
		Description: "Go 1.15"
	}]
	Networks: []
	Env: ["A=B"]
	Delims: ["{{", "}}"]
	Terminals: [{
		Name:        "term1"
		Description: "The main terminal"
		Scenarios: {
			go115: {
				Image: "this_will_never_be_used"
			}
		}
	}]
	Langs: {
		en: {
			Steps: {
				step1: {
					Name:     "step1"
					StepType: 1
					Terminal: "term1"
					Order:    0
					Stmts: [{
						Negated:  false
						CmdStr:   "echo -n \"Hello, world!\""
						ExitCode: 0
						Output:   "Hello, world!"
					}]
				}
				step2: {
					Name:     "step2"
					StepType: 2
					Terminal: "term1"
					Target:   "/home/gopher/special.sh"
					Language: "sh"
					Renderer: {
						RendererType: 1
					}
					Source: "echo -n \"Hello, world!\""
					Order:  1
				}
			}
			Hash: "49ad685197e42b0d67ae7c75791431837e5438e96d13b6023c45c3483c979ff7"
		}
	}
}
